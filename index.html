<!DOCTYPE html>
<html lang="zh" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>留学中｜留学生活 · 交易与社区</title>
  <meta name="description" content="Unilink：留学生生活一站式平台。真实交易、社区交流、院校评价、常用服务。">
  <meta name="keywords" content="Unilink, 留学生, 二手交易, 跑腿, 代购, 校园, 社区, 院校评价, 留学生活">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{ --brand:#1d1d1f; --ink:#1d1d1f; --sub:#6e6e73; --line:#d2d2d7; --bg:#ffffff; --bg-alt:#f5f5f7; --radius:20px; --ease:cubic-bezier(.2,.7,.2,1) }
    html,body{background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','SF Pro Text','Helvetica Neue',Arial,sans-serif;scroll-behavior:smooth}
    .container-apple{max-width:1200px;margin:0 auto;padding:0 24px}
    .glass{backdrop-filter:saturate(180%) blur(20px);background:rgba(255,255,255,.82)}
    .eyebrow{letter-spacing:.08em;text-transform:uppercase;font-size:12px;color:var(--sub);font-weight:700}
    .h1{font-size:64px;line-height:1.02;letter-spacing:-.02em;font-weight:800}
    .h2{font-size:36px;line-height:1.1;letter-spacing:-.01em;font-weight:700}
    .sub{font-size:17px;color:var(--sub)}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:14px 22px;border-radius:999px;font-weight:600;transition:transform .2s var(--ease),box-shadow .3s var(--ease),background .3s var(--ease)}
    .btn-black{background:var(--brand);color:#fff}
    .btn-black:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.15)}
    .btn-outline{border:1px solid var(--brand);color:var(--brand);background:#fff}
    .btn-outline:hover{background:var(--brand);color:#fff;transform:translateY(-2px)}
    .tile{border-radius:var(--radius);border:1px solid var(--line);background:#fff;transition:transform .25s var(--ease),box-shadow .3s var(--ease),border-color .2s var(--ease)}
    .tile:hover{transform:translateY(-4px);box-shadow:0 16px 40px rgba(0,0,0,.06);border-color:#bcbcc2}
    .hero{position:relative;overflow:hidden;background:linear-gradient(180deg,#fff,#f7f7f9)}
    .hero-inner{position:relative;z-index:2;padding:120px 0;text-align:center;color:var(--ink)}
    .brand-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(0,0,0,.04);backdrop-filter:saturate(160%) blur(6px);border:1px solid #e5e5ea;border-radius:14px;padding:8px 12px;color:var(--ink)}
    .brand-badge .dot{width:8px;height:8px;border-radius:50%;background:var(--brand)}
    .drawer{position:fixed;right:0;top:0;height:100vh;width:360px;max-width:92vw;background:#fff;border-left:1px solid var(--line);box-shadow:-20px 0 60px rgba(0,0,0,.12);transform:translateX(100%);transition:transform .3s var(--ease);z-index:70;overflow-y:auto;-webkit-overflow-scrolling:touch}
    .drawer.active{transform:translateX(0)}
    .drawer header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line)}
    @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .fade{animation:fadeUp .6s var(--ease) both}
    .d1{animation-delay:.08s}.d2{animation-delay:.16s}.d3{animation-delay:.24s}
    :focus-visible{outline:3px solid #2688ff; outline-offset:2px; border-radius:10px}
    .table-wrap{overflow:auto}
    @media (max-width:1024px){.h1{font-size:44px}.h2{font-size:28px}.hero-inner{padding:96px 0}}
    @media (max-width:640px){.h1{font-size:34px}.h2{font-size:22px}.hero-inner{padding:72px 0}}
    .seg{display:inline-flex;background:#fff;border:1px solid var(--line);border-radius:999px;padding:4px}
    .seg input{position:absolute;opacity:0;pointer-events:none}
    .seg label{position:relative;cursor:pointer;min-width:90px;text-align:center;padding:8px 14px;border-radius:999px;font-weight:600;color:var(--sub);transition:all .2s var(--ease)}
    .seg input:checked + label{background:var(--brand);color:#fff;box-shadow:0 6px 16px rgba(0,0,0,.12)}
    .seg label:hover{color:#111}
    .country-dropdown{position:relative;min-width:140px}
    .country-dropdown select{width:100%;padding:10px 16px;border-radius:12px;border:1px solid var(--line);appearance:none;background:white;font-size:14px;font-weight:500}
    .country-dropdown:after{content:"";position:absolute;right:12px;top:50%;transform:translateY(-50%);width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid var(--sub);pointer-events:none}
    .page{position:fixed;inset:0;background:#fff;z-index:80;opacity:0;transform:translateX(100%);transition:transform .35s var(--ease), opacity .35s var(--ease);pointer-events:none}
    .page.active{opacity:1;transform:translateX(0);pointer-events:auto}
    .page-header{display:flex;align-items:center;gap:12px;padding:16px 24px;border-bottom:1px solid var(--line);background:#fff}
    .page-content{padding:24px;overflow-y:auto;height:calc(100vh - 70px)}
    .help{font-size:12px;color:#6e6e73}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid #e5e5ea;background:#fafafa;font-size:12px}
    /* 聊天相关样式 */
    .chat-panel{position:fixed;right:16px;bottom:16px;z-index:90;width:min(420px,92vw);height:520px;border:1px solid var(--line);border-radius:16px;background:#fff;box-shadow:0 12px 40px rgba(0,0,0,.15);display:none;flex-direction:column}
    .chat-panel.active{display:flex}
    .chat-header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--line)}
    .chat-body{flex:1;overflow:auto;padding:12px}
    .chat-item{margin:8px 0;display:flex;gap:8px}
    .chat-me{justify-content:flex-end}
    .chat-bubble{max-width:75%;padding:10px 12px;border-radius:14px;border:1px solid #e5e5ea;background:#fafafa;font-size:14px;line-height:1.4}
    .chat-me .chat-bubble{background:#111;color:#fff;border-color:#111}
    .chat-meta{font-size:11px;color:#6e6e73;margin-top:2px}
    .chat-input{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line);background:#fff}
    .chat-input input{flex:1;border:1px solid var(--line);border-radius:999px;padding:10px 14px}
    /* 聊天大厅样式 */
    .chat-lobby{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;padding:16px}
    .chat-room-card{display:flex;flex-direction:column;border:1px solid var(--line);border-radius:12px;overflow:hidden;transition:all .2s var(--ease)}
    .chat-room-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.08)}
    .chat-room-header{padding:12px;background:var(--bg-alt);display:flex;align-items:center;gap:8px}
    .chat-room-body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .chat-room-footer{padding:12px;border-top:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .chat-room-avatar{width:40px;height:40px;border-radius:50%;background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:bold}
    .chat-room-title{font-weight:600;flex:1}
    .chat-room-desc{font-size:14px;color:var(--sub);line-height:1.4}
    .chat-room-meta{display:flex;align-items:center;gap:12px;font-size:13px;color:var(--sub)}
    .chat-room-meta i{margin-right:4px}
    .chat-room-badge{background:var(--brand);color:#fff;padding:2px 8px;border-radius:999px;font-size:12px;font-weight:600}
    .chat-tab-bar{display:flex;border-bottom:1px solid var(--line);background:#fff}
    .chat-tab{flex:1;text-align:center;padding:12px;font-weight:600;color:var(--sub);transition:all .2s var(--ease);border-bottom:2px solid transparent}
    .chat-tab.active{color:var(--brand);border-bottom-color:var(--brand)}
    /* 悬浮聊天按钮 */
    .chat-toggle-btn{position:fixed;right:16px;bottom:80px;width:52px;height:52px;border-radius:50%;background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(0,0,0,.15);z-index:80;transition:transform .2s var(--ease)}
    .chat-toggle-btn:hover{transform:scale(1.05)}
    .chat-indicator{position:absolute;top:-4px;right:-4px;width:18px;height:18px;border-radius:50%;background:#ff3b30;color:#fff;font-size:11px;display:flex;align-items:center;justify-content:center}
    .chat-action-btn{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;border-radius:999px;background:var(--bg-alt);font-size:13px;font-weight:500;color:var(--ink);transition:all .2s var(--ease)}
    .chat-action-btn:hover{background:#e5e5ea}
  
    .cmt-images{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .cmt-images img{width:80px;height:80px;object-fit:cover;border-radius:8px;border:1px solid #e5e5ea}
    .cmt-actions{display:flex;gap:10px;margin-top:6px}
    .cmt-actions button{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid #d2d2d7}
    .cmt-badge{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid #e5e5ea;background:#fafafa;font-size:12px}
    .cmt-reported{opacity:.6;filter:grayscale(30%)}
  </style>
</head>
<body>
  <a href="#home" class="sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 bg-[var(--brand)] text-white px-3 py-1 rounded z-[100]">跳到主要内容</a>

  <header class="sticky top-0 z-50 glass border-b border-[#e5e5ea]">
    <div class="container-apple py-3 flex items-center justify-between">
      <a href="#home" class="flex items-center gap-2" aria-label="Unilink 首页">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-[var(--brand)] text-white text-sm font-bold">U</span>
        <b>Unilink</b><span id="globalVerifyBadge" class="ml-2 badge" style="display:none"><i class="fa-solid fa-shield"></i><span>已认证</span></span>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-[15px]" aria-label="主导航">
        <a class="hover:opacity-70" href="#trade">交易</a>
        <a class="hover:opacity-70" href="#community">社区</a>
        <a class="hover:opacity-70" href="#reviews">院校评价</a>
        <a class="hover:opacity-70" href="#resources">服务中心</a>
      </nav>
      <div class="flex items-center gap-3">
        <button id="publishBtnTop" class="btn btn-black">发布</button>
        <button id="avatarBtn" class="w-9 h-9 rounded-full border flex items-center justify-center" aria-label="打开个人菜单">
          <i class="fa-regular fa-user"></i>
        </button>
      </div>
    </div>
  </header>

  <main>
    <section id="home" class="hero">
      <div class="container-apple hero-inner">
        <div class="brand-badge fade mx-auto"><span class="dot"></span><span class="text-[13px]">留学中 · 品牌主阵地</span></div>
        <h1 class="h1 mt-6 fade d1">留学生活，从这里连接</h1>
        <p class="sub mt-3 max-w-2xl mx-auto fade d2">交易、社区与院校评价的统一入口。为在校留学生提供跑腿代购、二手交易、经验交流与择校参考。</p>
        <div class="mt-8 flex flex-wrap justify-center gap-4 fade d3">
          <button class="btn btn-black" data-page="taskhall">进入交易</button>
          <button class="btn btn-outline" data-page="community-home">进入社区</button>
          <button class="btn btn-outline" data-page="reviews-all">院校评价</button>
        </div>
      </div>
    </section>

    <section id="trade" class="py-20 bg-[var(--bg)]">
      <div class="container-apple">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-6">
          <div>
            <div class="eyebrow">TRADE</div>
            <h2 class="h2 mt-1">交易 · 任务 / 跑腿 / 二手 / 团购</h2>
            <p class="sub mt-1">面向留学中用户的高频刚需，平台撮合更高效</p>
          </div>
          <div class="flex items-center gap-3">
            <button class="btn btn-outline" id="publishBtnTrade">发布需求</button>
            <button class="chat-action-btn" data-page="trade-chat-lobby">
              <i class="fa-regular fa-comments"></i> 交易聊天
            </button>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
          <a class="tile p-6 block cursor-pointer" data-page="taskhall"><h3 class="font-semibold text-lg">任务大厅</h3><p class="sub mt-1">悬赏占座、搬运行李、代购</p></a>
          <a class="tile p-6 block cursor-pointer" data-page="errands"><h3 class="font-semibold text-lg">跑腿代购</h3><p class="sub mt-1">校内 30 分钟达 · 实时位置</p></a>
          <a class="tile p-6 block cursor-pointer" data-page="market"><h3 class="font-semibold text-lg">二手市场</h3><p class="sub mt-1">真图真价 · 当面验货</p></a>
          <a class="tile p-6 block cursor-pointer" data-page="groupbuy"><h3 class="font-semibold text-lg">校园团购</h3><p class="sub mt-1">本地商家拼单优惠</p></a>
        </div>

        <div>
          <div class="flex items-center justify-between mb-3">
            <h3 class="h2">最新发布</h3>
            <button id="refreshPosts" class="text-[14px] text-[#6e6e73] hover:text-black">刷新</button>
          </div>
          <div id="postsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <div class="mt-12">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold text-lg">来自我的发布</h3>
            <button class="text-[14px] text-[#6e6e73] hover:text-black" id="clearMyPosts">清空</button>
          </div>
          <div id="tradeMyPosts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
          <div id="tradeMyPostsEmpty" class="text-[#6e6e73]">暂无内容，点击上方"发布需求"试试～</div>
        </div>
      </div>
    </section>

    <section id="community" class="py-20 bg-[var(--bg-alt)]">
      <div class="container-apple">
        <div class="flex items-end justify之间 mb-6">
          <div>
            <div class="eyebrow">COMMUNITY</div>
            <h2 class="h2 mt-1">社区 · 热门话题与活动</h2>
            <p class="sub mt-1">真实交流，沉淀高质量经验与口碑</p>
          </div>
          <div class="flex items-center gap-3">
            <button class="btn btn-outline" data-page="community-home">进入社区</button>
            <button class="chat-action-btn" data-page="community-chat-lobby">
              <i class="fa-regular fa-comments"></i> 社区聊天
            </button>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="communityCards"></div>
      </div>
    </section>

    <section id="reviews" class="py-20 bg-[var(--bg)]">
      <div class="container-apple">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-6">
          <div>
            <div class="eyebrow">REVIEWS</div>
            <h2 class="h2 mt-1">院校评价</h2>
            <p class="sub mt-1">按院校/专业/维度查看真实体验，可搜索与排序</p>
          </div>
          <div class="flex items-center gap-3">
            <div class="relative">
              <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-[#6e6e73]"></i>
              <input id="reviewsSearch" class="pl-9 pr-3 py-2 border rounded-full text-[15px]" placeholder="搜索：院校/专业" />
            </div>
            <button class="btn btn-outline" data-page="reviews-all">查看全部院校</button>
          </div>
        </div>
        <div class="tile table-wrap">
          <table class="min-w-full text-[15px]">
            <thead class="bg-[#fafafa] border-b select-none">
              <tr>
                <th scope="col" class="text-left py-3 px-4 cursor-pointer" data-sort="school">院校</th>
                <th scope="col" class="text-left py-3 px-4">课程强度</th>
                <th scope="col" class="text-left py-3 px-4">生活便利</th>
                <th scope="col" class="text-left py-3 px-4">就业资源</th>
                <th scope="col" class="text-left py-3 px-4 cursor-pointer" data-sort="score">总体评分</th>
                <th scope="col" class="text-left py-3 px-4">详情</th>
              </tr>
            </thead>
            <tbody id="reviewsTbody" aria-live="polite"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="resources" class="py-20 bg-[var(--bg-alt)]">
      <div class="container-apple">
        <h2 class="h2">常用服务</h2>
        <p class="sub mt-1 mb-6">签证/住宿/校务/兼职等入口</p>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-6">
          <a class="tile p-6 text-center cursor-pointer" data-page="svc-campus"><i class="fa-solid fa-id-card text-2xl mb-2"></i><div class="font-semibold">学生证/校车</div><div class="sub">校务与交通</div></a>
          <a class="tile p-6 text-center cursor-pointer" data-page="svc-visa"><i class="fa-solid fa-shield-halved text-2xl mb-2"></i><div class="font-semibold">签证/居留</div><div class="sub">出入境相关</div></a>
          <a class="tile p-6 text-center cursor-pointer" data-page="svc-housing"><i class="fa-solid fa-house-chimney text-2xl mb-2"></i><div class="font-semibold">住宿/租房</div><div class="sub">校内外房源</div></a>
          <a class="tile p-6 text-center cursor-pointer" data-page="svc-jobs"><i class="fa-solid fa-briefcase text-2xl mb-2"></i><div class="font-semibold">兼职/实习</div><div class="sub">岗位与内推</div></a>
          <a class="tile p-6 text-center cursor-pointer" data-page="membership"><i class="fa-solid fa-crown text-2xl mb-2"></i><div class="font-semibold">会员中心</div><div class="sub">VIP 特权与管理</div></a>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-t">
    <div class="container-apple py-10 text-[13px] text-[#6e6e73]">© 2025 Unilink · 留学生活 · 交易与社区</div>
  </footer>

  <nav id="mobileTabs" class="md:hidden fixed bottom-0 inset-x-0 bg-white/90 backdrop-blur border-t z-40" style="padding-bottom:env(safe-area-inset-bottom)">
    <div class="grid grid-cols-5 text-sm text-[#6e6e73]">
      <a href="#home" class="flex flex-col items-center py-2"><i class="fa-solid fa-house"></i><span>首页</span></a>
      <a href="#trade" class="flex flex-col items-center py-2"><i class="fa-solid fa-bag-shopping"></i><span>交易</span></a>
      <a href="#community" class="flex flex-col items-center py-2"><i class="fa-solid fa-people-group"></i><span>社区</span></a>
      <a href="#reviews" class="flex flex-col items-center py-2"><i class="fa-solid fa-graduation-cap"></i><span>院校</span></a>
      <a href="#resources" class="flex flex-col items-center py-2"><i class="fa-solid fa-gear"></i><span>我的</span></a>
    </div>
  </nav>

  <!-- 用户抽屉、弹层、页面、聊天等脚本（与您之前版本一致） -->
  <script>
    const $$ = s => Array.from(document.querySelectorAll(s));
    const $  = s => document.querySelector(s);

    // Supabase 初始化（已注入你的项目值）
    const SUPABASE_URL = "https://udshfcppherkuzxxlghr.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkc2hmY3BwaGVya3V6eHhsZ2hyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NjQzOTIsImV4cCI6MjA3MjQ0MDM5Mn0.8razzbs61yRk9bmwr71smYim6auM5Edj_j22Iu6Y9sA";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 其余逻辑：为简化演示，仅保留要点 —— 列表加载 & 基本交互
    async function loadPosts(){ 
      const { data, error } = await supabase.from('posts').select('*').order('created_at', { ascending: false });
      if (error) { console.error(error); return; }
      const card = p => `<div class="tile p-4">
        <div class="flex items-center justify-between">
          <div class="font-semibold">${p.title||'(无标题)'} ${p.urgent?'<span class="ml-1 text-xs text-red-600">紧急</span>':''}</div>
          <span class="text-[13px] text-[#6e6e73]">${p.type||''}</span>
        </div>
        <div class="text-[14px] mt-2 line-clamp-2">${p.description||''}</div>
        <div class="text-[13px] mt-2">${p.country||''}${p.school?(' · '+p.school):''}${p.campus?(' · '+p.campus):''}</div>
        <div class="mt-3 flex gap-2">
          <button class="btn btn-outline flex-1" data-open-detail="${p.id}">查看</button>
          <button class="btn btn-black flex-1" data-open-chat="${p.id}" data-title="${p.title||'聊天'}"><i class="fa-regular fa-comments"></i>&nbsp;聊天</button>
        </div>
      </div>`;
      document.getElementById('postsList').innerHTML = (data||[]).filter(p=>p.status!=='done').slice(0,9).map(card).join('') || '<div class="text-[#6e6e73]">暂无发布</div>';
    }
    loadPosts();

    // 简化的页面切换
    document.querySelectorAll('[data-page]').forEach(el=>{
      el.addEventListener('click', e=>{
        e.preventDefault();
        const id = el.getAttribute('data-page');
        const page = document.querySelector('#page-'+id);
        if(!page) return;
        document.querySelectorAll('#pageRouter .page').forEach(p=>p.classList.remove('active'));
        page.classList.add('active');
        document.body.style.overflow='hidden';
      });
    });
  </script>
</body>
</html>
